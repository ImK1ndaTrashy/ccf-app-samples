<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Confidential Secret Santa</title>

    <script
      type="text/javascript"
      src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"
      integrity="sha384-DUSOaqAzlZRiZxkDi8hL7hXJDZ+X39ZOAYV9ZDx44gUv9pozmcunJH02tjSFLPnW"
      crossorigin="anonymous"
    ></script>

    <!-- adding Bootstrap 4 for UI components  -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      rel="SHORTCUT ICON"
      href="https://c.s-microsoft.com/favicon.ico?v2"
      type="image/x-icon"
    />
    <style>
      .bg-santa {
        background-color: #850101;
      }

      .btn-secondarybutton {
        background-color: #ff000d;
      }

      .btn-secondarybutton:hover {
        background-color: #c41212;
        border-color: #a81414;
      }

      .btn-primarybutton {
        background-color: #ff000d;
      }

      .btn-primarybutton:hover {
        background-color: #c41212;
        border-color: #a81414;
      }

      body {
        background-image: url("https://static.vecteezy.com/system/resources/previews/013/682/519/original/seamless-pattern-with-christmas-candy-cane-caramel-and-snowflakes-endless-background-repeating-texture-vector.jpg");
        background-color: #cccccc;
        background-size: 35%;
      }

      .footer {
        position: fixed;
        text-align: center;
        bottom: 0px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.9);
      }

      .cardsanta {
        background-color: rgba(255, 255, 255, 0.9);
      }
    </style>
  </head>
  <body>
    <div class="footer">Credits: Seb</div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-santa">
      <a class="navbar-brand" href="/">Confidential Secret Santa ðŸŽ…</a>
      <div class="btn-group ml-auto dropleft">
      </div>
    </nav>
    <br />
    <div class="santabackground">
      <div class="row" style="margin: auto">
        <div id="card-div" class="col-md-4" style="display: none">
          <div class="cardsanta text-left">
            <div class="card-body">
              <h5 class="card-title" id="WelcomeMessage">
                Please sign-in to register and see who you should buy a gift
                for.
              </h5>
              <div id="profile-div"><p /></div>
              <div id="group-div">
                <table > 
                  <thead> <tr> <th> <b>Person:â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž </b> </th><th><b>Buys for:â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž</b></th></tr> </thead>
                <tbody id = "groupTable"> </tbody>
                </table>
                <br/>
                <button id='generate_button' class='btn btn-primarybutton' onclick='generate()'>Generate</button>
                <button
                id="CreateGroup"
                class="btn btn-secondarybutton"
                id="createGroup"
                onclick="createGroup('')"
                hidden="true"
              >
                Add Name
              </button> 
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- importing bootstrap.js and supporting js libraries -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>

    <!-- importing app scripts | load order is important -->
    <script type="text/javascript">
      const signInButton = document.getElementById("SignIn");

      // Select DOM elements to work with
      const welcomeDiv = document.getElementById("WelcomeMessage");
      const cardDiv = document.getElementById("card-div");
      const profileButton = document.getElementById("seeProfile");
      const createGroupButton = document.getElementById("CreateGroup");
      const profileDiv = document.getElementById("profile-div");

      function getRandomInt(max) {
        return Math.floor(Math.random() * max);
      }

      async function generate() {
        const generate_button = document.getElementById("generate_button");
        generate_button.innerHTML = "Generating...";
        alert("Your names have been paired successfully");
        const group = document.getElementById("groupTable");
        var names = [];
        for (var i = 0; i < group.children.length; i++) {
          names.push(group.children[i].children[0].innerHTML);
        }
        var matchs = [];
        // This is what adds elements to the end of the array.
        restart: do {
          matchs = [];
          for (var a = 0; a < names.length; a++) {
            matchs.push(a);
          }
          // We are using the Fisherâ€“Yates shuffle. 'https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle'
          for (let i = names.length - 1; i > 0; i--) {
            const j = getRandomInt(i + 1);
            if (matchs[j] == i)
              // This is what will reset the code if someone gets their own name.
              // The restart was created earlier near the start of the code.
              continue restart;
            const tmp = matchs[i];
            matchs[i] = matchs[j];
            matchs[j] = tmp;
          }
          if (matchs[0] != 0) break;
        } while (true);

        for (var i = 0; i < group.children.length; i++) {
          group.children[i].children[1].innerHTML = names[matchs[i]];
        }

        generate_button.innerHTML = "Generate";
      }
            var getId = (function () {
        var incrementingId = 0;
        return function(element) {
          if (!element.id) {
            element.id = "id_" + incrementingId++;
            // Possibly add a check if this ID really is unique
          }
          return element.id;
        };
      }());
      function hide(id) {
          var x = document.getElementById(id);
            x.style.display = "none";
        }
      async function createGroup(str) {
        const newInput = document.createElement("input");
        newInput.type = "text";
        newInput.value = str;
        newInput.className = "Group Name";
        const createGroupButton = document.getElementById("CreateGroup");
        cardDiv.appendChild(newInput);
        createGroupButton.innerHTML = "Saving Group";
        const newButton = document.createElement("button");
        newButton.className = "btn btn-primarybutton";
        newButton.innerHTML = "Submit First Name";

        var action=function() {       
          const groupTable = document.getElementById("groupTable")
          const tableRow = document.createElement("tr");
          const tableElement = document.createElement("td");
          const tableElement2 = document.createElement("td");
          const tableElement3 = document.createElement("td");
          const tableElement4 = document.createElement("td");
          tableElement.innerHTML = newInput.value
          tableElement2.innerHTML = "unassigned"
          tableElement3.innerHTML = "<b> (Delete) â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž â€Ž </b>"
          tableElement4.innerHTML = "<b> (Edit) </b>"
          tableRow.appendChild (tableElement)
          tableRow.appendChild (tableElement2)
          tableRow.appendChild (tableElement3)
          tableRow.appendChild (tableElement4)
          groupTable.appendChild (tableRow) 
          hide(newButton.id);
          hide(newInput.id);
          var idcount = 0
          tableElement3.setAttribute("onclick", "del_in(this);");
          tableElement4.onclick = function() {
            createGroup(tableElement.innerHTML);del_in(tableElement);
          }
        };

        getId (newButton);     
        getId (newInput);     
        newButton.onclick = action
        
        newInput.addEventListener("keypress", function(event) {
          if (event.key === "Enter") {
          event.preventDefault();
          action()
          }
        });
        cardDiv.appendChild(newButton);
      
        createGroupButton.innerHTML = "Add Name";
      }
      
      function del_in(e) {    
              e.parentNode.remove();
          }

      cardDiv.style.display = "initial";
      welcomeDiv.innerHTML = "Welcome to Secret Santa";

      createGroupButton.hidden = false;
    </script>
  </body>
</html>
